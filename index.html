<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gest√£o H√≠drica - Base Naval & Lespan</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üíß</text></svg>">

    <!-- Bibliotecas -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --navy-primary: #0a2342;
            --navy-secondary: #2ca58d;
            --money-color: #198754;
            --lespan-color: #e56b6f;
            --bg-color: #f4f6f9;
        }
        body { background-color: var(--bg-color); font-family: 'Segoe UI', sans-serif; }
        .card { border: none; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; background: white; }
        .card-header { background-color: white; border-bottom: 1px solid #eee; font-weight: 700; color: var(--navy-primary); padding: 15px; }
        
        /* Navega√ß√£o */
        .nav-pills .nav-link { color: var(--navy-primary); font-weight: 600; margin-right: 10px; background: white; border: 1px solid #dee2e6; }
        .nav-pills .nav-link.active { background-color: var(--navy-primary); color: white; border-color: var(--navy-primary); }
        
        /* KPIs */
        .kpi-value { font-size: 1.8rem; font-weight: 800; color: var(--navy-primary); }
        .kpi-label { font-size: 0.8rem; color: #6c757d; text-transform: uppercase; font-weight: 700; }
        .money-text { color: var(--money-color); }
        
        /* Tabelas */
        .table th { background-color: #f8f9fa; }
        .trend-up { color: #dc3545; font-weight: bold; } /* Vermelho se subir consumo */
        .trend-down { color: #198754; font-weight: bold; } /* Verde se cair consumo */
    </style>
</head>
<body>

<div class="container py-4">
    
    <!-- Topo -->
    <div class="d-flex flex-wrap justify-content-between align-items-center mb-4 gap-3">
        <div>
            <h2 class="fw-bold mb-0 text-primary"><i class="fa-solid fa-faucet-drip me-2"></i>Gest√£o H√≠drica</h2>
            <p class="text-muted mb-0">Monitoramento: Base Naval & Lespan</p>
        </div>
        <div class="bg-white p-2 rounded border d-flex align-items-center">
            <label class="fw-bold text-muted me-2 small">ANO DE VISUALIZA√á√ÉO:</label>
            <select id="yearSelect" class="form-select form-select-sm fw-bold border-0 bg-light" style="width: 100px;" onchange="updateUI()">
                <option value="2025">2025</option>
                <option value="2024">2024</option>
            </select>
        </div>
    </div>

    <!-- KPIs (Indicadores) -->
    <div class="row g-3 mb-4">
        <div class="col-md-3">
            <div class="card p-3 h-100 border-start border-4 border-primary">
                <div class="kpi-label">CONSUMO TOTAL</div>
                <div class="kpi-value" id="kpiVol">0</div>
                <small class="text-muted">Metros C√∫bicos (m¬≥)</small>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card p-3 h-100 border-start border-4 border-success">
                <div class="kpi-label">CUSTO TOTAL</div>
                <div class="kpi-value money-text" id="kpiCost">R$ 0,00</div>
                <small class="text-muted">Valor Faturado</small>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card p-3 h-100 border-start border-4 border-warning">
                <div class="kpi-label">PRE√áO M√âDIO</div>
                <div class="kpi-value text-warning" id="kpiAvg">R$ 0,00</div>
                <small class="text-muted">Por m¬≥</small>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card p-3 h-100 border-start border-4 border-danger">
                <div class="kpi-label">MAIOR FATURA</div>
                <div class="kpi-value text-danger" id="kpiMax">R$ 0,00</div>
                <small class="text-muted" id="kpiMaxMonth">-</small>
            </div>
        </div>
    </div>

    <!-- Menu de Abas -->
    <ul class="nav nav-pills mb-4" id="pills-tab" role="tablist">
        <li class="nav-item"><button class="nav-link active" data-bs-toggle="pill" data-bs-target="#tab-dash">üìä Dashboard</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#tab-2025">2025 Detalhado</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#tab-2024">2024 Detalhado</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#tab-comp">‚öñÔ∏è Comparativo</button></li>
    </ul>

    <div class="tab-content">
        
        <!-- ABA 1: DASHBOARD -->
        <div class="tab-pane fade show active" id="tab-dash">
            <!-- Gr√°fico Financeiro -->
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span><i class="fa-solid fa-chart-mixed me-2"></i>An√°lise: Consumo (m¬≥) vs Custo (R$)</span>
                </div>
                <div class="card-body">
                    <canvas id="chartFinance" height="80"></canvas>
                </div>
            </div>
            <!-- Gr√°fico Volume -->
            <div class="row">
                <div class="col-md-8">
                    <div class="card h-100">
                        <div class="card-header">Volume por Unidade</div>
                        <div class="card-body">
                            <canvas id="chartVolume" height="150"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100">
                        <div class="card-header">Resumo</div>
                        <div class="card-body">
                            <div class="alert alert-primary">
                                <strong><i class="fas fa-info-circle"></i> Status dos Dados</strong><br>
                                Os dados apresentados refletem as faturas lan√ßadas at√© o momento. Meses futuros aparecem zerados.
                            </div>
                            <hr>
                            <ul class="list-unstyled" id="statusList"></ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ABA 2: 2025 -->
        <div class="tab-pane fade" id="tab-2025">
            <div class="card">
                <div class="card-header bg-primary text-white">Faturas de 2025</div>
                <div class="card-body table-responsive p-0">
                    <table class="table table-striped table-hover mb-0 align-middle text-center">
                        <thead class="table-dark">
                            <tr>
                                <th>M√™s</th><th>Base Naval (m¬≥)</th><th>Lespan (m¬≥)</th><th>Total (m¬≥)</th><th>Valor (R$)</th>
                            </tr>
                        </thead>
                        <tbody id="tbody2025"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ABA 3: 2024 -->
        <div class="tab-pane fade" id="tab-2024">
            <div class="card">
                <div class="card-header">Hist√≥rico 2024</div>
                <div class="card-body table-responsive p-0">
                    <table class="table table-striped table-hover mb-0 align-middle text-center">
                        <thead class="table-dark">
                            <tr>
                                <th>M√™s</th><th>Base Naval (m¬≥)</th><th>Lespan (m¬≥)</th><th>Total (m¬≥)</th><th>Valor (R$)</th>
                            </tr>
                        </thead>
                        <tbody id="tbody2024"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ABA 4: COMPARATIVO -->
        <div class="tab-pane fade" id="tab-comp">
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">Comparativo de Volume (m¬≥)</div>
                        <div class="card-body"><canvas id="chartCompVol" height="150"></canvas></div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">Comparativo Financeiro (R$)</div>
                        <div class="card-body"><canvas id="chartCompFin" height="150"></canvas></div>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-header">Tabela de Varia√ß√£o (2025 vs 2024)</div>
                <div class="card-body table-responsive p-0">
                    <table class="table table-bordered text-center mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>M√™s</th><th>m¬≥ 2024</th><th>m¬≥ 2025</th><th>Var. Vol</th><th>R$ 2024</th><th>R$ 2025</th><th>Var. R$</th>
                            </tr>
                        </thead>
                        <tbody id="tbodyComp"></tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>
</div>

<script>
    // =====================================================
    // DADOS DOS GR√ÅFICOS E TABELAS
    // =====================================================
    
    // NOMES DOS MESES
    const months = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];

    // BASE DE DADOS - VOLUME (m¬≥)
    // IMPORTANTE: Se o m√™s ainda n√£o chegou, usamos 0 para n√£o quebrar o gr√°fico
    const dataVol = {
        baseNaval: {
            2024: [39599, 41471, 38758, 40874, 39625, 33576, 32257, 29161, 30129, 37508, 24498, 28735],
            2025: [29523, 31152, 31525, 35663, 33971, 28708, 31069, 31039, 30794, 37508, 0, 0]
        },
        lespan: {
            2024: [171, 81, 124, 111, 217, 54, 111, 287, 153, 153, 166, 254],
            2025: [103, 133, 324, 352, 417, 555, 763, 567, 706, 153, 0, 0]
        }
    };

    // BASE DE DADOS - FINANCEIRO (R$)
    const dataFin = {
        2024: [1309686, 1286805, 1306085, 1392186, 1263393, 1120495, 1075082, 981056, 1004037, 1254901, 821544, 1084810],
        2025: [1113089, 1175472, 1196680, 1353333, 1292153, 1080406, 1196040, 874621, 1355213, 1225487, 0, 0]
    };

    // Vari√°veis globais para os gr√°ficos
    let chVol, chFin, chCmpVol, chCmpFin;

    // INICIALIZAR
    document.addEventListener('DOMContentLoaded', () => {
        updateUI();
        renderTables();
    });

    // ATUALIZAR TELA AO MUDAR O ANO
    function updateUI() {
        const year = document.getElementById('yearSelect').value;
        
        // 1. Atualizar KPIs
        const volsBN = dataVol.baseNaval[year];
        const volsLP = dataVol.lespan[year];
        const costs = dataFin[year];
        
        let sumVol = 0, sumCost = 0, maxCost = 0, maxCostIdx = 0;

        for(let i=0; i<12; i++) {
            const v = (volsBN[i] || 0) + (volsLP[i] || 0);
            const c = (costs[i] || 0);
            sumVol += v;
            sumCost += c;
            if(c > maxCost) { maxCost = c; maxCostIdx = i; }
        }

        const avgPrice = sumVol > 0 ? (sumCost / sumVol) : 0;

        document.getElementById('kpiVol').innerText = sumVol.toLocaleString('pt-BR');
        document.getElementById('kpiCost').innerText = sumCost.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
        document.getElementById('kpiAvg').innerText = avgPrice.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
        document.getElementById('kpiMax').innerText = maxCost.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
        document.getElementById('kpiMaxMonth').innerText = maxCost > 0 ? months[maxCostIdx] : '-';

        // 2. Atualizar Lista Status
        const filled = volsBN.filter(v => v > 0).length;
        const statusList = document.getElementById('statusList');
        statusList.innerHTML = `<li><strong>Dados preenchidos:</strong> ${filled} de 12 meses</li>`;

        // 3. Renderizar Gr√°ficos
        renderCharts(year);
    }

    function renderCharts(year) {
        const volsBN = dataVol.baseNaval[year];
        const volsLP = dataVol.lespan[year];
        const costs = dataFin[year];
        
        // Dados totais para gr√°fico financeiro
        const totalVol = volsBN.map((v, i) => v + (volsLP[i] || 0));
        
        // --- GR√ÅFICO DE VOLUME (BARRAS EMPILHADAS) ---
        if(chVol) chVol.destroy();
        chVol = new Chart(document.getElementById('chartVolume'), {
            type: 'bar',
            data: {
                labels: months,
                datasets: [
                    { label: 'Base Naval', data: volsBN, backgroundColor: '#0a2342' },
                    { label: 'Lespan', data: volsLP, backgroundColor: '#e56b6f' }
                ]
            },
            options: { responsive: true, scales: { x: { stacked: true }, y: { stacked: true } } }
        });

        // --- GR√ÅFICO FINANCEIRO (COMBO) ---
        if(chFin) chFin.destroy();
        chFin = new Chart(document.getElementById('chartFinance'), {
            type: 'bar',
            data: {
                labels: months,
                datasets: [
                    { label: 'Valor Pago (R$)', data: costs, type: 'line', borderColor: '#198754', backgroundColor: 'rgba(25,135,84,0.1)', yAxisID: 'y1', tension: 0.3, fill: true },
                    { label: 'Consumo (m¬≥)', data: totalVol, backgroundColor: 'rgba(13,110,253,0.5)', yAxisID: 'y' }
                ]
            },
            options: {
                responsive: true,
                scales: {
                    y: { position: 'left', title: { display: true, text: 'Volume (m¬≥)' } },
                    y1: { position: 'right', title: { display: true, text: 'Reais (R$)' }, grid: { drawOnChartArea: false } }
                }
            }
        });

        // --- GR√ÅFICOS COMPARATIVOS ---
        // Comparativo Volume
        const vol24 = dataVol.baseNaval[2024].map((v, i) => v + dataVol.lespan[2024][i]);
        const vol25 = dataVol.baseNaval[2025].map((v, i) => v + dataVol.lespan[2025][i]);
        
        // Filtra zeros do 2025 para o gr√°fico de linha n√£o cair pra zero abruptamente
        const vol25Clean = vol25.map(v => v > 0 ? v : null);
        
        if(chCmpVol) chCmpVol.destroy();
        chCmpVol = new Chart(document.getElementById('chartCompVol'), {
            type: 'line',
            data: {
                labels: months,
                datasets: [
                    { label: '2024', data: vol24, borderColor: '#adb5bd', borderDash: [5,5] },
                    { label: '2025', data: vol25Clean, borderColor: '#0a2342', borderWidth: 3 }
                ]
            }
        });

        // Comparativo Financeiro
        const fin24 = dataFin[2024];
        const fin25 = dataFin[2025].map(v => v > 0 ? v : null);

        if(chCmpFin) chCmpFin.destroy();
        chCmpFin = new Chart(document.getElementById('chartCompFin'), {
            type: 'bar',
            data: {
                labels: months,
                datasets: [
                    { label: '2024', data: fin24, backgroundColor: '#adb5bd' },
                    { label: '2025', data: fin25, backgroundColor: '#198754' }
                ]
            }
        });
    }

    function renderTables() {
        const tbody25 = document.getElementById('tbody2025');
        const tbody24 = document.getElementById('tbody2024');
        const tbodyComp = document.getElementById('tbodyComp');

        let html25 = '', html24 = '', htmlComp = '';

        for(let i=0; i<12; i++) {
            // Dados 2025
            let bn25 = dataVol.baseNaval[2025][i] || 0;
            let lp25 = dataVol.lespan[2025][i] || 0;
            let tot25 = bn25 + lp25;
            let c25 = dataFin[2025][i] || 0;
            
            // S√≥ mostra na tabela se tiver valor ou se n√£o tiver passado o ano todo
            html25 += `<tr>
                <td>${months[i]}</td>
                <td>${bn25 > 0 ? bn25.toLocaleString() : '-'}</td>
                <td>${lp25 > 0 ? lp25.toLocaleString() : '-'}</td>
                <td class="fw-bold text-primary">${tot25 > 0 ? tot25.toLocaleString() : '-'}</td>
                <td class="fw-bold text-success">${c25 > 0 ? c25.toLocaleString('pt-BR', {style:'currency', currency:'BRL'}) : '-'}</td>
            </tr>`;

            // Dados 2024
            let bn24 = dataVol.baseNaval[2024][i] || 0;
            let lp24 = dataVol.lespan[2024][i] || 0;
            let tot24 = bn24 + lp24;
            let c24 = dataFin[2024][i] || 0;

            html24 += `<tr>
                <td>${months[i]}</td>
                <td>${bn24.toLocaleString()}</td>
                <td>${lp24.toLocaleString()}</td>
                <td class="fw-bold text-primary">${tot24.toLocaleString()}</td>
                <td class="fw-bold text-success">${c24.toLocaleString('pt-BR', {style:'currency', currency:'BRL'})}</td>
            </tr>`;

            // Comparativo
            let varVol = (tot25 > 0 && tot24 > 0) ? ((tot25 - tot24)/tot24)*100 : 0;
            let varCost = (c25 > 0 && c24 > 0) ? ((c25 - c24)/c24)*100 : 0;
            
            let classVol = varVol > 0 ? 'trend-up' : (varVol < 0 ? 'trend-down' : '');
            let classCost = varCost > 0 ? 'trend-up' : (varCost < 0 ? 'trend-down' : '');
            
            let arrowVol = varVol > 0 ? '‚ñ≤' : '‚ñº';
            let arrowCost = varCost > 0 ? '‚ñ≤' : '‚ñº';

            // Se n√£o tem dado em 2025, mostra tra√ßo
            let displayVarVol = tot25 > 0 ? `<span class="${classVol}">${arrowVol} ${Math.abs(varVol).toFixed(1)}%</span>` : '-';
            let displayVarCost = c25 > 0 ? `<span class="${classCost}">${arrowCost} ${Math.abs(varCost).toFixed(1)}%</span>` : '-';

            htmlComp += `<tr>
                <td>${months[i]}</td>
                <td>${tot24.toLocaleString()}</td>
                <td>${tot25 > 0 ? tot25.toLocaleString() : '-'}</td>
                <td>${displayVarVol}</td>
                <td>${c24.toLocaleString('pt-BR', {style:'currency', currency:'BRL'})}</td>
                <td>${c25 > 0 ? c25.toLocaleString('pt-BR', {style:'currency', currency:'BRL'}) : '-'}</td>
                <td>${displayVarCost}</td>
            </tr>`;
        }

        tbody25.innerHTML = html25;
        tbody24.innerHTML = html24;
        tbodyComp.innerHTML = htmlComp;
    }

</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
